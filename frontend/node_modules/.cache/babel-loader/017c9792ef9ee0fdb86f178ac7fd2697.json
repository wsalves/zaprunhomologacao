{"ast":null,"code":"import React,{useState,useEffect,useContext}from\"react\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import{makeStyles,Paper,Tabs,Tab}from\"@material-ui/core\";import TabPanel from\"../../components/TabPanel\";import SchedulesForm from\"../../components/SchedulesForm\";import CompaniesManager from\"../../components/CompaniesManager\";import PlansManager from\"../../components/PlansManager\";import HelpsManager from\"../../components/HelpsManager\";import Options from\"../../components/Settings/Options\";import Whitelabel from\"../../components/Settings/Whitelabel\";import{i18n}from\"../../translate/i18n.js\";import{toast}from\"react-toastify\";import useCompanies from\"../../hooks/useCompanies\";import{AuthContext}from\"../../context/Auth/AuthContext\";import OnlyForSuperUser from\"../../components/OnlyForSuperUser\";import useCompanySettings from\"../../hooks/useSettings/companySettings\";import useSettings from\"../../hooks/useSettings\";import ForbiddenPage from\"../../components/ForbiddenPage/index.js\";const useStyles=makeStyles(theme=>({root:{flex:1,backgroundColor:theme.palette.background.paper},mainPaper:{...theme.scrollbarStyles,overflowY:\"scroll\",flex:1},tab:{// background: \"#f2f5f3\",\nbackgroundColor:theme.mode==='light'?\"#f2f2f2\":\"#7f7f7f\",borderRadius:4},paper:{...theme.scrollbarStyles,overflowY:\"scroll\",padding:theme.spacing(2),display:\"flex\",alignItems:\"center\",width:\"100%\"},container:{width:\"100%\",maxHeight:\"100%\"},control:{padding:theme.spacing(1)},textfield:{width:\"100%\"}}));const SettingsCustom=()=>{const classes=useStyles();const[tab,setTab]=useState(\"options\");const[schedules,setSchedules]=useState([]);const[company,setCompany]=useState({});const[loading,setLoading]=useState(false);const[currentUser,setCurrentUser]=useState({});const[settings,setSettings]=useState({});const[oldSettings,setOldSettings]=useState({});const[schedulesEnabled,setSchedulesEnabled]=useState(false);const{find,updateSchedules}=useCompanies();//novo hook\nconst{getAll:getAllSettings}=useCompanySettings();const{getAll:getAllSettingsOld}=useSettings();const{user,socket}=useContext(AuthContext);useEffect(()=>{async function findData(){setLoading(true);try{const companyId=user.companyId;const company=await find(companyId);const settingList=await getAllSettings(companyId);const settingListOld=await getAllSettingsOld();setCompany(company);setSchedules(company.schedules);setSettings(settingList);setOldSettings(settingListOld);/*  if (Array.isArray(settingList)) {\n           const scheduleType = settingList.find(\n             (d) => d.key === \"scheduleType\"\n           );\n           if (scheduleType) {\n             setSchedulesEnabled(scheduleType.value === \"company\");\n           }\n         } */setSchedulesEnabled(settingList.scheduleType===\"company\");setCurrentUser(user);}catch(e){toast.error(e);}setLoading(false);}findData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const handleTabChange=(event,newValue)=>{setTab(newValue);};const handleSubmitSchedules=async data=>{setLoading(true);try{setSchedules(data);await updateSchedules({id:company.id,schedules:data});toast.success(\"HorÃ¡rios atualizados com sucesso.\");}catch(e){toast.error(e);}setLoading(false);};const isSuper=()=>{return currentUser.super;};return/*#__PURE__*/React.createElement(MainContainer,{className:classes.root},user.profile===\"user\"?/*#__PURE__*/React.createElement(ForbiddenPage,null):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(MainHeader,null,/*#__PURE__*/React.createElement(Title,null,i18n.t(\"settings.title\"))),/*#__PURE__*/React.createElement(Paper,{className:classes.mainPaper,elevation:1},/*#__PURE__*/React.createElement(Tabs,{value:tab,indicatorColor:\"primary\",textColor:\"primary\",scrollButtons:\"on\",variant:\"scrollable\",onChange:handleTabChange,className:classes.tab},/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.options\"),value:\"options\"}),schedulesEnabled&&/*#__PURE__*/React.createElement(Tab,{label:\"Hor\\xE1rios\",value:\"schedules\"}),isSuper()?/*#__PURE__*/React.createElement(Tab,{label:\"Empresas\",value:\"companies\"}):null,isSuper()?/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.plans\"),value:\"plans\"}):null,isSuper()?/*#__PURE__*/React.createElement(Tab,{label:i18n.t(\"settings.tabs.helps\"),value:\"helps\"}):null,isSuper()?/*#__PURE__*/React.createElement(Tab,{label:\"Whitelabel\",value:\"whitelabel\"}):null),/*#__PURE__*/React.createElement(Paper,{className:classes.paper,elevation:0},/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"schedules\"},/*#__PURE__*/React.createElement(SchedulesForm,{loading:loading,onSubmit:handleSubmitSchedules,initialValues:schedules})),/*#__PURE__*/React.createElement(OnlyForSuperUser,{user:currentUser,yes:()=>/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"companies\"},/*#__PURE__*/React.createElement(CompaniesManager,null)),/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"plans\"},/*#__PURE__*/React.createElement(PlansManager,null)),/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"helps\"},/*#__PURE__*/React.createElement(HelpsManager,null)),/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"whitelabel\"},/*#__PURE__*/React.createElement(Whitelabel,{settings:oldSettings})))}),/*#__PURE__*/React.createElement(TabPanel,{className:classes.container,value:tab,name:\"options\"},/*#__PURE__*/React.createElement(Options,{settings:settings,oldSettings:oldSettings,user:currentUser,scheduleTypeChanged:value=>setSchedulesEnabled(value===\"company\")}))))));};export default SettingsCustom;","map":null,"metadata":{},"sourceType":"module"}