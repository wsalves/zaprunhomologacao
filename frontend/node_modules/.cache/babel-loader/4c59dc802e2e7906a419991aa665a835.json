{"ast":null,"code":"import React,{useEffect,useState,useContext}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import Typography from\"@material-ui/core/Typography\";import IconButton from\"@material-ui/core/IconButton\";import CloseIcon from\"@material-ui/icons/Close\";import Drawer from\"@material-ui/core/Drawer\";import Link from\"@material-ui/core/Link\";import InputLabel from\"@material-ui/core/InputLabel\";// import Avatar from \"@material-ui/core/Avatar\";\nimport Button from\"@material-ui/core/Button\";import Paper from\"@material-ui/core/Paper\";import CreateIcon from'@material-ui/icons/Create';import formatSerializedId from'../../utils/formatSerializedId';import{i18n}from\"../../translate/i18n\";import ModalImageCors from\"../ModalImageCors\";import ContactDrawerSkeleton from\"../ContactDrawerSkeleton\";import MarkdownWrapper from\"../MarkdownWrapper\";import{CardHeader,Switch,Tooltip}from\"@material-ui/core\";import{ContactForm}from\"../ContactForm\";import ContactModal from\"../ContactModal\";import{ContactNotes}from\"../ContactNotes\";import{AuthContext}from\"../../context/Auth/AuthContext\";import useCompanySettings from\"../../hooks/useSettings/companySettings\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import{toast}from\"react-toastify\";import{TagsKanbanContainer}from\"../TagsKanbanContainer\";const drawerWidth=320;const useStyles=makeStyles(theme=>({drawer:{width:drawerWidth,flexShrink:0},drawerPaper:{width:drawerWidth,display:\"flex\",borderTop:\"1px solid rgba(0, 0, 0, 0.12)\",borderRight:\"1px solid rgba(0, 0, 0, 0.12)\",borderBottom:\"1px solid rgba(0, 0, 0, 0.12)\",borderTopRightRadius:4,borderBottomRightRadius:4},header:{display:\"flex\",borderBottom:\"1px solid rgba(0, 0, 0, 0.12)\",backgroundColor:theme.palette.inputBackground,alignItems:\"center\",padding:theme.spacing(0,1),minHeight:\"50px\",justifyContent:\"flex-start\"},content:{display:\"flex\",backgroundColor:theme.palette.inputBackground,flexDirection:\"column\",padding:\"8px 0px 8px 8px\",height:\"100%\",justifyContent:\"center\",overflowY:\"scroll\",...theme.scrollbarStyles},contactAvatar:{margin:15,width:160,height:160,borderRadius:10},contactHeader:{display:\"flex\",padding:8,flexDirection:\"column\",alignItems:\"center\",justifyContent:\"center\",\"& > *\":{margin:4}},contactDetails:{marginTop:8,padding:8,display:\"flex\",flexDirection:\"column\"},contactExtraInfo:{marginTop:4,padding:6}}));const ContactDrawer=_ref=>{var _contact$extraInfo;let{open,handleDrawerClose,contact,ticket,loading}=_ref;const classes=useStyles();const[modalOpen,setModalOpen]=useState(false);const[blockingContact,setBlockingContact]=useState(contact.active);const[openForm,setOpenForm]=useState(false);const{get}=useCompanySettings();const[hideNum,setHideNum]=useState(false);const{user}=useContext(AuthContext);const[acceptAudioMessage,setAcceptAudio]=useState(contact.acceptAudioMessage);useEffect(()=>{async function fetchData(){const lgpdHideNumber=await get({\"column\":\"lgpdHideNumber\"});if(lgpdHideNumber===\"enabled\")setHideNum(true);}fetchData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{setOpenForm(false);},[open,contact]);const handleContactToggleAcceptAudio=async()=>{try{const contact=await api.put(\"/contacts/toggleAcceptAudio/\".concat(ticket.contact.id));setAcceptAudio(contact.data.acceptAudioMessage);}catch(err){toastError(err);}};const handleBlockContact=async contactId=>{try{await api.put(\"/contacts/block/\".concat(contactId),{active:false});toast.success(\"Contato bloqueado\");}catch(err){toastError(err);}setBlockingContact(true);};const handleUnBlockContact=async contactId=>{try{await api.put(\"/contacts/block/\".concat(contactId),{active:true});toast.success(\"Contato desbloqueado\");}catch(err){toastError(err);}setBlockingContact(false);};if(loading)return null;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Drawer,{className:classes.drawer,variant:\"persistent\",anchor:\"right\",open:open,PaperProps:{style:{position:\"absolute\"}},BackdropProps:{style:{position:\"absolute\"}},ModalProps:{container:document.getElementById(\"drawer-container\"),style:{position:\"absolute\"}},classes:{paper:classes.drawerPaper}},/*#__PURE__*/React.createElement(\"div\",{className:classes.header},/*#__PURE__*/React.createElement(IconButton,{onClick:handleDrawerClose},/*#__PURE__*/React.createElement(CloseIcon,null)),/*#__PURE__*/React.createElement(Typography,{style:{justifySelf:\"center\"}},i18n.t(\"contactDrawer.header\"))),/*#__PURE__*/React.createElement(\"div\",null,!loading?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Typography,{style:{marginBottom:8,marginTop:12},variant:\"subtitle1\"},/*#__PURE__*/React.createElement(Switch,{size:\"small\",checked:acceptAudioMessage,onChange:()=>handleContactToggleAcceptAudio(),name:\"disableBot\",color:\"primary\"}),i18n.t(\"ticketOptionsMenu.acceptAudioMessage\"))):/*#__PURE__*/React.createElement(\"br\",null)),loading?/*#__PURE__*/React.createElement(ContactDrawerSkeleton,{classes:classes}):/*#__PURE__*/React.createElement(\"div\",{className:classes.content},/*#__PURE__*/React.createElement(Paper,{square:true,variant:\"outlined\",className:classes.contactHeader},/*#__PURE__*/React.createElement(ModalImageCors,{imageUrl:contact===null||contact===void 0?void 0:contact.urlPicture}),/*#__PURE__*/React.createElement(CardHeader,{onClick:()=>{},style:{cursor:\"pointer\",width:'100%'},titleTypographyProps:{noWrap:true},subheaderTypographyProps:{noWrap:true},title:/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Typography,{onClick:()=>setOpenForm(true)},contact.name,/*#__PURE__*/React.createElement(CreateIcon,{style:{fontSize:16,marginLeft:5}}))),subheader:/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Typography,{style:{fontSize:12}},hideNum&&user.profile===\"user\"?formatSerializedId(contact.number).slice(0,-6)+\"**-**\"+contact.number.slice(-2):formatSerializedId(contact.number)),/*#__PURE__*/React.createElement(Typography,{style:{color:\"primary\",fontSize:12}},/*#__PURE__*/React.createElement(Link,{href:\"mailto:\".concat(contact.email)},contact.email)))}),/*#__PURE__*/React.createElement(Button,{variant:\"outlined\",color:\"primary\",onClick:()=>setModalOpen(!openForm),style:{fontSize:12}},i18n.t(\"contactDrawer.buttons.edit\")),/*#__PURE__*/React.createElement(Button,{variant:\"outlined\",color:\"secondary\",onClick:()=>contact.active?handleBlockContact(contact.id):handleUnBlockContact(contact.id),disabled:loading},!contact.active?\"Desbloquear contato\":\"Bloquear contato\"),contact.id&&openForm&&/*#__PURE__*/React.createElement(ContactForm,{initialContact:contact,onCancel:()=>setOpenForm(false)})),/*#__PURE__*/React.createElement(TagsKanbanContainer,{ticket:ticket,className:classes.contactTags}),/*#__PURE__*/React.createElement(Paper,{square:true,variant:\"outlined\",className:classes.contactDetails},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle1\",style:{marginBottom:10}},i18n.t(\"ticketOptionsMenu.appointmentsModal.title\")),/*#__PURE__*/React.createElement(ContactNotes,{ticket:ticket})),/*#__PURE__*/React.createElement(Paper,{square:true,variant:\"outlined\",className:classes.contactDetails},/*#__PURE__*/React.createElement(ContactModal,{open:modalOpen,onClose:()=>setModalOpen(false),contactId:contact.id}),/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle1\"},i18n.t(\"contactDrawer.extraInfo\")),contact===null||contact===void 0?void 0:(_contact$extraInfo=contact.extraInfo)===null||_contact$extraInfo===void 0?void 0:_contact$extraInfo.map(info=>/*#__PURE__*/React.createElement(Paper,{key:info.id,square:true,variant:\"outlined\",className:classes.contactExtraInfo},/*#__PURE__*/React.createElement(InputLabel,null,info.name),/*#__PURE__*/React.createElement(Typography,{component:\"div\",noWrap:true,style:{paddingTop:2}},/*#__PURE__*/React.createElement(MarkdownWrapper,null,info.value))))))));};export default ContactDrawer;","map":null,"metadata":{},"sourceType":"module"}