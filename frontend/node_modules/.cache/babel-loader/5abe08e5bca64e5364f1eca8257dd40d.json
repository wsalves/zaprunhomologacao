{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport { getData, getSanitizedData, intersect } from '..';\nimport { uncompress } from '../data';\nimport store from '../store';\nvar NimbleEmojiIndex = /*#__PURE__*/\nfunction () {\n  function NimbleEmojiIndex(data, set) {\n    _classCallCheck(this, NimbleEmojiIndex);\n    if (data.compressed) {\n      uncompress(data);\n    }\n    this.data = data || {};\n    this.set = set || null;\n    this.originalPool = {};\n    this.index = {};\n    this.emojis = {};\n    this.emoticons = {};\n    this.customEmojisList = [];\n    this.buildIndex();\n  }\n  _createClass(NimbleEmojiIndex, [{\n    key: \"buildIndex\",\n    value: function buildIndex() {\n      var _this = this;\n      var _loop = function _loop(emoji) {\n        var emojiData = _this.data.emojis[emoji],\n          short_names = emojiData.short_names,\n          emoticons = emojiData.emoticons,\n          skin_variations = emojiData.skin_variations,\n          id = short_names[0];\n        if (emoticons) {\n          emoticons.forEach(function (emoticon) {\n            if (_this.emoticons[emoticon]) {\n              return;\n            }\n            _this.emoticons[emoticon] = id;\n          });\n        } // If skin variations include them\n\n        if (skin_variations) {\n          _this.emojis[id] = {};\n          for (var skinTone = 1; skinTone <= 6; skinTone++) {\n            _this.emojis[id][skinTone] = getSanitizedData({\n              id: id,\n              skin: skinTone\n            }, skinTone, _this.set, _this.data);\n          }\n        } else {\n          _this.emojis[id] = getSanitizedData(id, null, _this.set, _this.data);\n        }\n        _this.originalPool[id] = emojiData;\n      };\n      for (var emoji in this.data.emojis) {\n        _loop(emoji);\n      }\n    }\n  }, {\n    key: \"clearCustomEmojis\",\n    value: function clearCustomEmojis(pool) {\n      var _this2 = this;\n      this.customEmojisList.forEach(function (emoji) {\n        var emojiId = emoji.id || emoji.short_names[0];\n        delete pool[emojiId];\n        delete _this2.emojis[emojiId];\n      });\n    }\n  }, {\n    key: \"addCustomToPool\",\n    value: function addCustomToPool(custom, pool) {\n      var _this3 = this;\n      if (this.customEmojisList.length) this.clearCustomEmojis(pool);\n      custom.forEach(function (emoji) {\n        var emojiId = emoji.id || emoji.short_names[0];\n        if (emojiId && !pool[emojiId]) {\n          pool[emojiId] = getData(emoji, null, null, _this3.data);\n          _this3.emojis[emojiId] = getSanitizedData(emoji, null, null, _this3.data);\n        }\n      });\n      this.customEmojisList = custom;\n      this.index = {};\n    }\n  }, {\n    key: \"search\",\n    value: function search(value) {\n      var _this4 = this;\n      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        emojisToShowFilter = _ref.emojisToShowFilter,\n        maxResults = _ref.maxResults,\n        include = _ref.include,\n        exclude = _ref.exclude,\n        _ref$custom = _ref.custom,\n        custom = _ref$custom === void 0 ? [] : _ref$custom;\n      if (this.customEmojisList != custom) this.addCustomToPool(custom, this.originalPool);\n      var skinTone = store.get('skin') || 1;\n      maxResults || (maxResults = 75);\n      include || (include = []);\n      exclude || (exclude = []);\n      var results = null,\n        pool = this.originalPool;\n      if (value.length) {\n        if (value == '-' || value == '-1') {\n          return [this.emojis['-1'][skinTone]];\n        }\n        var values = value.toLowerCase().split(/[\\s|,|\\-|_]+/),\n          allResults = [];\n        if (values.length > 2) {\n          values = [values[0], values[1]];\n        }\n        if (include.length || exclude.length) {\n          pool = {};\n          this.data.categories.forEach(function (category) {\n            var isIncluded = include && include.length ? include.indexOf(category.id) > -1 : true;\n            var isExcluded = exclude && exclude.length ? exclude.indexOf(category.id) > -1 : false;\n            if (!isIncluded || isExcluded) {\n              return;\n            }\n            category.emojis.forEach(function (emojiId) {\n              return pool[emojiId] = _this4.data.emojis[emojiId];\n            });\n          });\n          if (custom.length) {\n            var customIsIncluded = include && include.length ? include.indexOf('custom') > -1 : true;\n            var customIsExcluded = exclude && exclude.length ? exclude.indexOf('custom') > -1 : false;\n            if (customIsIncluded && !customIsExcluded) {\n              this.addCustomToPool(custom, pool);\n            }\n          }\n        }\n        allResults = values.map(function (value) {\n          var aPool = pool,\n            aIndex = _this4.index,\n            length = 0;\n          for (var charIndex = 0; charIndex < value.length; charIndex++) {\n            var _char = value[charIndex];\n            length++;\n            aIndex[_char] || (aIndex[_char] = {});\n            aIndex = aIndex[_char];\n            if (!aIndex.results) {\n              (function () {\n                var scores = {};\n                aIndex.results = [];\n                aIndex.pool = {};\n                for (var id in aPool) {\n                  var emoji = aPool[id],\n                    search = emoji.search,\n                    sub = value.substr(0, length),\n                    subIndex = search.indexOf(sub);\n                  if (subIndex != -1) {\n                    var score = subIndex + 1;\n                    if (sub == id) score = 0;\n                    if (_this4.emojis[id] && _this4.emojis[id][skinTone]) {\n                      aIndex.results.push(_this4.emojis[id][skinTone]);\n                    } else {\n                      aIndex.results.push(_this4.emojis[id]);\n                    }\n                    aIndex.pool[id] = emoji;\n                    scores[id] = score;\n                  }\n                }\n                aIndex.results.sort(function (a, b) {\n                  var aScore = scores[a.id],\n                    bScore = scores[b.id];\n                  if (aScore == bScore) {\n                    return a.id.localeCompare(b.id);\n                  } else {\n                    return aScore - bScore;\n                  }\n                });\n              })();\n            }\n            aPool = aIndex.pool;\n          }\n          return aIndex.results;\n        }).filter(function (a) {\n          return a;\n        });\n        if (allResults.length > 1) {\n          results = intersect.apply(null, allResults);\n        } else if (allResults.length) {\n          results = allResults[0];\n        } else {\n          results = [];\n        }\n      }\n      if (results) {\n        if (emojisToShowFilter) {\n          results = results.filter(function (result) {\n            return emojisToShowFilter(pool[result.id]);\n          });\n        }\n        if (results && results.length > maxResults) {\n          results = results.slice(0, maxResults);\n        }\n      }\n      return results;\n    }\n  }]);\n  return NimbleEmojiIndex;\n}();\nexport { NimbleEmojiIndex as default };","map":null,"metadata":{},"sourceType":"module"}