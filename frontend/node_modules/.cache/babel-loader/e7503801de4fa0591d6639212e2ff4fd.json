{"ast":null,"code":"import React,{useState,useEffect,useContext,useRef,useCallback}from\"react\";import{useParams,useHistory}from\"react-router-dom\";import clsx from\"clsx\";import{makeStyles,Paper}from\"@material-ui/core\";import ContactDrawer from\"../ContactDrawer\";import MessageInput from\"../MessageInput\";import TicketHeader from\"../TicketHeader\";import TicketInfo from\"../TicketInfo\";import TicketActionButtons from\"../TicketActionButtonsCustom\";import MessagesList from\"../MessagesList\";import api from\"../../services/api\";import{ReplyMessageProvider}from\"../../context/ReplyingMessage/ReplyingMessageContext\";import{ForwardMessageProvider}from\"../../context/ForwarMessage/ForwardMessageContext\";import toastError from\"../../errors/toastError\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{TagsContainer}from\"../TagsContainer\";import{isNil}from'lodash';import{EditMessageProvider}from\"../../context/EditingMessage/EditingMessageContext\";import{TicketsContext}from\"../../context/Tickets/TicketsContext\";const drawerWidth=320;const useStyles=makeStyles(theme=>({root:{display:\"flex\",height:\"100%\",position:\"relative\",overflow:\"hidden\"},mainWrapper:{flex:1,height:\"100%\",display:\"flex\",flexDirection:\"column\",overflow:\"hidden\",borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:\"0\",marginRight:-drawerWidth,transition:theme.transitions.create(\"margin\",{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.leavingScreen})},mainWrapperShift:{borderTopRightRadius:0,borderBottomRightRadius:0,transition:theme.transitions.create(\"margin\",{easing:theme.transitions.easing.easeOut,duration:theme.transitions.duration.enteringScreen}),marginRight:0}}));const Ticket=()=>{const{ticketId}=useParams();const history=useHistory();const classes=useStyles();const{user,socket}=useContext(AuthContext);const{setTabOpen}=useContext(TicketsContext);const[drawerOpen,setDrawerOpen]=useState(false);const[loading,setLoading]=useState(true);const[contact,setContact]=useState({});const[ticket,setTicket]=useState({});const[dragDropFiles,setDragDropFiles]=useState([]);const{companyId}=user;useEffect(()=>{},[ticket]);useEffect(()=>{setLoading(true);const delayDebounceFn=setTimeout(()=>{const fetchTicket=async()=>{try{if(!isNil(ticketId)&&ticketId!==\"undefined\"){const{data}=await api.get(\"/tickets/u/\"+ticketId);setContact(data.contact);// setWhatsapp(data.whatsapp);\n// setQueueId(data.queueId);\nsetTicket(data);if([\"pending\",\"open\",\"group\"].includes(data.status)){setTabOpen(data.status);}setLoading(false);}}catch(err){history.push(\"/tickets\");// correção para evitar tela branca uuid não encontrado Feito por Altemir 16/08/2023\nsetLoading(false);toastError(err);}};fetchTicket();},500);return()=>clearTimeout(delayDebounceFn);},[ticketId,user,history]);useEffect(()=>{if(!ticket&&!ticket.id&&ticket.uuid!==ticketId&&ticketId===\"undefined\"){return;}if(user.companyId){//    const socket = socketManager.GetSocket();\nconst onConnectTicket=()=>{socket.emit(\"joinChatBox\",\"\".concat(ticket.id));};const onCompanyTicket=data=>{if(data.action===\"update\"&&data.ticket.id===(ticket===null||ticket===void 0?void 0:ticket.id)){setTicket(data.ticket);}if(data.action===\"delete\"&&data.ticketId===(ticket===null||ticket===void 0?void 0:ticket.id)){history.push(\"/tickets\");}};const onCompanyContactTicket=data=>{if(data.action===\"update\"){// if (isMounted) {\nsetContact(prevState=>{var _data$contact;if(prevState.id===((_data$contact=data.contact)===null||_data$contact===void 0?void 0:_data$contact.id)){return{...prevState,...data.contact};}return prevState;});// }\n}};socket.on(\"connect\",onConnectTicket);socket.on(\"company-\".concat(companyId,\"-ticket\"),onCompanyTicket);socket.on(\"company-\".concat(companyId,\"-contact\"),onCompanyContactTicket);return()=>{socket.emit(\"joinChatBoxLeave\",\"\".concat(ticket.id));socket.off(\"connect\",onConnectTicket);socket.off(\"company-\".concat(companyId,\"-ticket\"),onCompanyTicket);socket.off(\"company-\".concat(companyId,\"-contact\"),onCompanyContactTicket);};}},[ticketId,ticket,history]);const handleDrawerOpen=useCallback(()=>{setDrawerOpen(true);},[]);const handleDrawerClose=useCallback(()=>{setDrawerOpen(false);},[]);const renderMessagesList=()=>{return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(MessagesList,{isGroup:ticket.isGroup,onDrop:setDragDropFiles,whatsappId:ticket.whatsappId,queueId:ticket.queueId,channel:ticket.channel}),/*#__PURE__*/React.createElement(MessageInput,{ticketId:ticket.id,ticketStatus:ticket.status,ticketChannel:ticket.channel,droppedFiles:dragDropFiles,contactId:contact.id}));};return/*#__PURE__*/React.createElement(\"div\",{className:classes.root,id:\"drawer-container\"},/*#__PURE__*/React.createElement(Paper,{variant:\"outlined\",elevation:0,className:clsx(classes.mainWrapper,{[classes.mainWrapperShift]:drawerOpen})},/*#__PURE__*/React.createElement(TicketHeader,{loading:loading},ticket.contact!==undefined&&/*#__PURE__*/React.createElement(\"div\",{id:\"TicketHeader\"},/*#__PURE__*/React.createElement(TicketInfo,{contact:contact,ticket:ticket,onClick:handleDrawerOpen})),/*#__PURE__*/React.createElement(TicketActionButtons,{ticket:ticket})),/*#__PURE__*/React.createElement(Paper,null,/*#__PURE__*/React.createElement(TagsContainer,{contact:contact})),/*#__PURE__*/React.createElement(ReplyMessageProvider,null,/*#__PURE__*/React.createElement(ForwardMessageProvider,null,/*#__PURE__*/React.createElement(EditMessageProvider,null,renderMessagesList())))),/*#__PURE__*/React.createElement(ContactDrawer,{open:drawerOpen,handleDrawerClose:handleDrawerClose,contact:contact,loading:loading,ticket:ticket}));};export default Ticket;","map":null,"metadata":{},"sourceType":"module"}