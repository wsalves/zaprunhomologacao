{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{useHistory}from\"react-router-dom\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import Avatar from\"@material-ui/core/Avatar\";import Typography from\"@material-ui/core/Typography\";import Grid from\"@material-ui/core/Grid\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{Button,Divider,useTheme}from\"@material-ui/core\";import{isNil}from'lodash';import ShowTicketOpen from'../ShowTicketOpenModal';import{grey}from'@material-ui/core/colors';const VcardPreview=_ref=>{let{contact,numbers,queueId,whatsappId}=_ref;const theme=useTheme();const history=useHistory();const{user}=useContext(AuthContext);const companyId=user.companyId;const[openAlert,setOpenAlert]=useState(false);const[userTicketOpen,setUserTicketOpen]=useState(\"\");const[queueTicketOpen,setQueueTicketOpen]=useState(\"\");const[selectedContact,setContact]=useState({id:0,name:\"\",number:0,profilePicUrl:\"\"});useEffect(()=>{const delayDebounceFn=setTimeout(()=>{const fetchContacts=async()=>{try{if(isNil(numbers)){return;}const number=numbers.replace(/\\D/g,\"\");const getData=await api.get(\"/contacts/profile/\".concat(number));if(getData.data.contactId&&getData.data.contactId!==0){let obj={id:getData.data.contactId,name:contact,number:numbers,profilePicUrl:getData.data.urlPicture};setContact(obj);}else{let contactObj={name:contact,number:number,email:\"\",companyId:companyId};const{data}=await api.post(\"/contacts\",contactObj);setContact(data);}}catch(err){console.log(err);toastError(err);}};fetchContacts();},500);return()=>clearTimeout(delayDebounceFn);},[companyId,contact,numbers]);const handleCloseAlert=()=>{setOpenAlert(false);setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");};const handleNewChat=async()=>{try{const{data:ticket}=await api.post(\"/tickets\",{contactId:selectedContact.id,userId:user.id,status:\"open\",queueId,companyId:companyId,whatsappId});history.push(\"/tickets/\".concat(ticket.uuid));}catch(err){const ticket=JSON.parse(err.response.data.error);if(ticket.userId!==(user===null||user===void 0?void 0:user.id)){setOpenAlert(true);setUserTicketOpen(ticket.user.name);setQueueTicketOpen(ticket.queue.name);}else{setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");history.push(\"/tickets/\".concat(ticket.uuid));}}};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{style:{minWidth:\"250px\"}},/*#__PURE__*/React.createElement(ShowTicketOpen,{isOpen:openAlert,handleClose:handleCloseAlert,user:userTicketOpen,queue:queueTicketOpen}),/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:2},/*#__PURE__*/React.createElement(Avatar,{src:\"\".concat(selectedContact===null||selectedContact===void 0?void 0:selectedContact.urlPicture)})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:9},/*#__PURE__*/React.createElement(Typography,{style:{marginTop:\"12px\",marginLeft:\"10px\"},color:\"primary\",variant:\"subtitle1\",gutterBottom:true},selectedContact.name)),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12},/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(Button,{fullWidth:true,color:\"primary\",onClick:handleNewChat,disabled:!selectedContact.number},\"Conversar\")))));};export default VcardPreview;","map":null,"metadata":{},"sourceType":"module"}