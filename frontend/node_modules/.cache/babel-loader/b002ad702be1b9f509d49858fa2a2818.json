{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import*as Yup from\"yup\";import{Formik,Form,Field}from\"formik\";import{toast}from\"react-toastify\";import{Typography,Button,Dialog,DialogActions,DialogContent,DialogTitle,CircularProgress,Select,InputLabel,MenuItem,FormControl,TextField,Grid,Paper}from\"@material-ui/core\";import{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\",gap:4},textField:{marginRight:theme.spacing(1),flex:1},btnWrapper:{position:\"relative\"},buttonProgress:{color:green[500],position:\"absolute\",top:\"50%\",left:\"50%\",marginTop:-12,marginLeft:-12},btnLeft:{display:\"flex\",marginRight:\"auto\",marginLeft:12},colorAdorment:{width:20,height:20}}));const DialogflowSchema=Yup.object().shape({name:Yup.string().min(2,\"Too Short!\").max(50,\"Too Long!\").required(\"Required\")// projectName: Yup.string()\n//   .min(3, \"Too Short!\")\n//   .max(100, \"Too Long!\")\n//   .required(),\n// jsonContent: Yup.string().min(3, \"Too Short!\").required(),\n// language: Yup.string().min(2, \"Too Short!\").max(50, \"Too Long!\").required(),\n});const QueueIntegration=_ref=>{let{open,onClose,integrationId}=_ref;const classes=useStyles();const initialState={type:\"typebot\",name:\"\",projectName:\"\",jsonContent:\"\",language:\"\",urlN8N:\"\",typebotDelayMessage:1000,typebotExpires:1,typebotKeywordFinish:\"\",typebotKeywordRestart:\"\",typebotRestartMessage:\"\",typebotSlug:\"\",typebotUnknownMessage:\"\"};const[integration,setIntegration]=useState(initialState);useEffect(()=>{(async()=>{if(!integrationId)return;try{const{data}=await api.get(\"/queueIntegration/\".concat(integrationId));setIntegration(prevState=>{return{...prevState,...data};});}catch(err){toastError(err);}})();return()=>{setIntegration({type:\"dialogflow\",name:\"\",projectName:\"\",jsonContent:\"\",language:\"\",urlN8N:\"\",typebotDelayMessage:1000});};},[integrationId,open]);const handleClose=()=>{onClose();setIntegration(initialState);};const handleTestSession=async(event,values)=>{try{const{projectName,jsonContent,language}=values;await api.post(\"/queueIntegration/testSession\",{projectName,jsonContent,language});toast.success(i18n.t(\"queueIntegrationModal.messages.testSuccess\"));}catch(err){toastError(err);}};const handleSaveDialogflow=async values=>{try{if(values.type==='n8n'||values.type==='webhook'||values.type==='typebot'||values.type===\"flowbuilder\")values.projectName=values.name;if(integrationId){await api.put(\"/queueIntegration/\".concat(integrationId),values);toast.success(i18n.t(\"queueIntegrationModal.messages.editSuccess\"));}else{await api.post(\"/queueIntegration\",values);toast.success(i18n.t(\"queueIntegrationModal.messages.addSuccess\"));}handleClose();}catch(err){toastError(err);}};return/*#__PURE__*/React.createElement(\"div\",{className:classes.root},/*#__PURE__*/React.createElement(Dialog,{open:open,onClose:handleClose,fullWidth:true,maxWidth:\"md\",scroll:\"paper\"},/*#__PURE__*/React.createElement(DialogTitle,null,integrationId?\"\".concat(i18n.t(\"queueIntegrationModal.title.edit\")):\"\".concat(i18n.t(\"queueIntegrationModal.title.add\"))),/*#__PURE__*/React.createElement(Formik,{initialValues:integration,enableReinitialize:true,validationSchema:DialogflowSchema,onSubmit:(values,actions,event)=>{setTimeout(()=>{handleSaveDialogflow(values);actions.setSubmitting(false);},400);}},_ref2=>{let{touched,errors,isSubmitting,values}=_ref2;return/*#__PURE__*/React.createElement(Form,null,/*#__PURE__*/React.createElement(Paper,{square:true,className:classes.mainPaper,elevation:1},/*#__PURE__*/React.createElement(DialogContent,{dividers:true},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",className:classes.formControl,margin:\"dense\",fullWidth:true},/*#__PURE__*/React.createElement(InputLabel,{id:\"type-selection-input-label\"},i18n.t(\"queueIntegrationModal.form.type\")),/*#__PURE__*/React.createElement(Field,{as:Select,label:i18n.t(\"queueIntegrationModal.form.type\"),name:\"type\",labelId:\"profile-selection-label\",error:touched.type&&Boolean(errors.type),helpertext:touched.type&&errors.type,id:\"type\",required:true},/*#__PURE__*/React.createElement(MenuItem,{value:\"dialogflow\"},\"DialogFlow\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"n8n\"},\"N8N\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"webhook\"},\"WebHooks\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"typebot\"},\"Typebot\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"flowbuilder\"},\"Flowbuilder\")))),values.type===\"dialogflow\"&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,name:\"name\",fullWidth:true,error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",className:classes.formControl,margin:\"dense\",fullWidth:true},/*#__PURE__*/React.createElement(InputLabel,{id:\"language-selection-input-label\"},i18n.t(\"queueIntegrationModal.form.language\")),/*#__PURE__*/React.createElement(Field,{as:Select,label:i18n.t(\"queueIntegrationModal.form.language\"),name:\"language\",labelId:\"profile-selection-label\",fullWidth:true,error:touched.language&&Boolean(errors.language),helpertext:touched.language&&errors.language,id:\"language-selection\",required:true},/*#__PURE__*/React.createElement(MenuItem,{value:\"pt-BR\"},\"Portugues\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"en\"},\"Ingl\\xEAs\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"es\"},\"Espa\\xF1ol\")))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.projectName\"),name:\"projectName\",error:touched.projectName&&Boolean(errors.projectName),helpertext:touched.projectName&&errors.projectName,fullWidth:true,variant:\"outlined\",margin:\"dense\"})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:12,xl:12},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.jsonContent\"),type:\"jsonContent\",multiline:true//inputRef={greetingRef}\n,maxRows:5,minRows:5,fullWidth:true,name:\"jsonContent\",error:touched.jsonContent&&Boolean(errors.jsonContent),helpertext:touched.jsonContent&&errors.jsonContent,variant:\"outlined\",margin:\"dense\"}))),(values.type===\"n8n\"||values.type===\"webhook\")&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,required:true,name:\"name\",error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:12,xl:12},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.urlN8N\"),name:\"urlN8N\",error:touched.urlN8N&&Boolean(errors.urlN8N),helpertext:touched.urlN8N&&errors.urlN8N,variant:\"outlined\",margin:\"dense\",required:true,fullWidth:true,className:classes.textField}))),values.type===\"flowbuilder\"&&/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,name:\"name\",fullWidth:true,error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",className:classes.textField})),values.type===\"typebot\"&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,name:\"name\",error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",required:true,fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:12,xl:12},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.urlN8N\"),name:\"urlN8N\",error:touched.urlN8N&&Boolean(errors.urlN8N),helpertext:touched.urlN8N&&errors.urlN8N,variant:\"outlined\",margin:\"dense\",required:true,fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotSlug\"),name:\"typebotSlug\",error:touched.typebotSlug&&Boolean(errors.typebotSlug),helpertext:touched.typebotSlug&&errors.typebotSlug,required:true,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotExpires\"),name:\"typebotExpires\",error:touched.typebotExpires&&Boolean(errors.typebotExpires),helpertext:touched.typebotExpires&&errors.typebotExpires,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotDelayMessage\"),name:\"typebotDelayMessage\",error:touched.typebotDelayMessage&&Boolean(errors.typebotDelayMessage),helpertext:touched.typebotDelayMessage&&errors.typebotDelayMessage,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotKeywordFinish\"),name:\"typebotKeywordFinish\",error:touched.typebotKeywordFinish&&Boolean(errors.typebotKeywordFinish),helpertext:touched.typebotKeywordFinish&&errors.typebotKeywordFinish,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotKeywordRestart\"),name:\"typebotKeywordRestart\",error:touched.typebotKeywordRestart&&Boolean(errors.typebotKeywordRestart),helpertext:touched.typebotKeywordRestart&&errors.typebotKeywordRestart,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6,xl:6},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotUnknownMessage\"),name:\"typebotUnknownMessage\",error:touched.typebotUnknownMessage&&Boolean(errors.typebotUnknownMessage),helpertext:touched.typebotUnknownMessage&&errors.typebotUnknownMessage,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:12,xl:12},/*#__PURE__*/React.createElement(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotRestartMessage\"),name:\"typebotRestartMessage\",error:touched.typebotRestartMessage&&Boolean(errors.typebotRestartMessage),helpertext:touched.typebotRestartMessage&&errors.typebotRestartMessage,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})))))),/*#__PURE__*/React.createElement(DialogActions,null,values.type===\"dialogflow\"&&/*#__PURE__*/React.createElement(Button//type=\"submit\"\n,{onClick:e=>handleTestSession(e,values),color:\"inherit\",disabled:isSubmitting,name:\"testSession\",variant:\"outlined\",className:classes.btnLeft},i18n.t(\"queueIntegrationModal.buttons.test\")),/*#__PURE__*/React.createElement(Button,{onClick:handleClose,color:\"secondary\",disabled:isSubmitting,variant:\"outlined\"},i18n.t(\"queueIntegrationModal.buttons.cancel\")),/*#__PURE__*/React.createElement(Button,{type:\"submit\",color:\"primary\",disabled:isSubmitting,variant:\"contained\",className:classes.btnWrapper},integrationId?\"\".concat(i18n.t(\"queueIntegrationModal.buttons.okEdit\")):\"\".concat(i18n.t(\"queueIntegrationModal.buttons.okAdd\")),isSubmitting&&/*#__PURE__*/React.createElement(CircularProgress,{size:24,className:classes.buttonProgress}))));})));};export default QueueIntegration;","map":null,"metadata":{},"sourceType":"module"}