{"ast":null,"code":"import React,{useContext,useEffect,useRef,useState}from\"react\";import{Box,FormControl,IconButton,Input,InputAdornment,makeStyles,Paper,Typography,Link}from\"@material-ui/core\";import SendIcon from\"@material-ui/icons/Send\";import AttachFileIcon from\"@material-ui/icons/AttachFile\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{useDate}from\"../../hooks/useDate\";import api from\"../../services/api\";const useStyles=makeStyles(theme=>({mainContainer:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,overflow:\"hidden\",borderRadius:0,height:\"100%\",borderLeft:\"1px solid rgba(0, 0, 0, 0.12)\"},messageList:{position:\"relative\",overflowY:\"auto\",height:\"100%\",...theme.scrollbarStyles,backgroundColor:theme.mode==='light'?\"#f2f2f2\":\"#7f7f7f\"},inputArea:{position:\"relative\",height:\"auto\"},input:{padding:\"20px\"},buttonSend:{margin:theme.spacing(1)},boxLeft:{padding:\"10px 10px 5px\",margin:\"10px\",position:\"relative\",backgroundColor:\"#ffffff\",color:\"#303030\",maxWidth:300,borderRadius:10,borderBottomLeftRadius:0,border:\"1px solid rgba(0, 0, 0, 0.12)\"},boxRight:{padding:\"10px 10px 5px\",margin:\"10px 10px 10px auto\",position:\"relative\",backgroundColor:\"#dcf8c6\",color:\"#303030\",textAlign:\"right\",maxWidth:300,borderRadius:10,borderBottomRightRadius:0,border:\"1px solid rgba(0, 0, 0, 0.12)\"},attachButton:{padding:8},attachmentPreview:{display:'flex',alignItems:'center',padding:'0 15px','& > *':{margin:'0 5px'}},fileInput:{display:'none'},messageContent:{wordBreak:'break-word'},fileLink:{color:theme.palette.primary.main,cursor:'pointer','&:hover':{textDecoration:'underline'}}}));export default function ChatMessages(_ref){let{chat,messages,handleSendMessage,handleLoadMore,scrollToBottomRef,pageInfo,loading}=_ref;const classes=useStyles();const{user,socket}=useContext(AuthContext);const{datetimeToClient}=useDate();const baseRef=useRef();const fileInputRef=useRef();const[contentMessage,setContentMessage]=useState(\"\");const[selectedFile,setSelectedFile]=useState(null);const scrollToBottom=()=>{if(baseRef.current){baseRef.current.scrollIntoView({});}};const unreadMessages=chat=>{if(chat!==undefined){const currentUser=chat.users.find(u=>u.userId===user.id);return currentUser.unreads>0;}return 0;};useEffect(()=>{if(unreadMessages(chat)>0){try{api.post(\"/chats/\".concat(chat.id,\"/read\"),{userId:user.id});}catch(err){}}scrollToBottomRef.current=scrollToBottom;// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const handleScroll=e=>{const{scrollTop}=e.currentTarget;if(!pageInfo.hasMore||loading)return;if(scrollTop<600){handleLoadMore();}};const handleFileSelect=e=>{const file=e.target.files[0];if(file){setSelectedFile(file);}};const handleSend=()=>{// Envia a mensagem se houver texto OU arquivo\nif(contentMessage.trim()!==\"\"||selectedFile){// Se nÃ£o houver mensagem de texto mas houver arquivo, envia uma string vazia\nconst messageText=contentMessage.trim()!==\"\"?contentMessage:\"ðŸ“Ž Arquivo anexado\";handleSendMessage(messageText,selectedFile);setContentMessage(\"\");setSelectedFile(null);if(fileInputRef.current){fileInputRef.current.value='';}}};return/*#__PURE__*/React.createElement(Paper,{className:classes.mainContainer},/*#__PURE__*/React.createElement(\"div\",{onScroll:handleScroll,className:classes.messageList},Array.isArray(messages)&&messages.map((item,key)=>{if(item.senderId===user.id){return/*#__PURE__*/React.createElement(Box,{key:key,className:classes.boxRight},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\"},item.sender.name),/*#__PURE__*/React.createElement(\"div\",{className:classes.messageContent},item.message,item.mediaPath&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Link,{href:\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/public/\").concat(item.mediaPath),target:\"_blank\",rel:\"noopener noreferrer\",className:classes.fileLink},\"\\uD83D\\uDCCE \",item.mediaName||'Arquivo anexado'))),/*#__PURE__*/React.createElement(Typography,{variant:\"caption\",display:\"block\"},datetimeToClient(item.createdAt)));}else{return/*#__PURE__*/React.createElement(Box,{key:key,className:classes.boxLeft},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\"},item.sender.name),/*#__PURE__*/React.createElement(\"div\",{className:classes.messageContent},item.message,item.mediaPath&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Link,{href:\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/public/\").concat(item.mediaPath),target:\"_blank\",rel:\"noopener noreferrer\",className:classes.fileLink},\"\\uD83D\\uDCCE \",item.mediaName||'Arquivo anexado'))),/*#__PURE__*/React.createElement(Typography,{variant:\"caption\",display:\"block\"},datetimeToClient(item.createdAt)));}}),/*#__PURE__*/React.createElement(\"div\",{ref:baseRef})),/*#__PURE__*/React.createElement(\"div\",{className:classes.inputArea},selectedFile&&/*#__PURE__*/React.createElement(\"div\",{className:classes.attachmentPreview},/*#__PURE__*/React.createElement(Typography,{variant:\"body2\"},\"\\uD83D\\uDCCE \",selectedFile.name),/*#__PURE__*/React.createElement(IconButton,{size:\"small\",onClick:()=>setSelectedFile(null)},\"\\u2715\")),/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",fullWidth:true},/*#__PURE__*/React.createElement(Input,{multiline:true,value:contentMessage,onKeyUp:e=>{if(e.key===\"Enter\"&&!e.shiftKey&&(contentMessage.trim()!==\"\"||selectedFile)){handleSend();}},onChange:e=>setContentMessage(e.target.value),className:classes.input,endAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"end\"},/*#__PURE__*/React.createElement(\"input\",{type:\"file\",ref:fileInputRef,onChange:handleFileSelect,className:classes.fileInput}),/*#__PURE__*/React.createElement(IconButton,{className:classes.attachButton,onClick:()=>fileInputRef.current.click()},/*#__PURE__*/React.createElement(AttachFileIcon,null)),/*#__PURE__*/React.createElement(IconButton,{onClick:handleSend,className:classes.buttonSend},/*#__PURE__*/React.createElement(SendIcon,null)))}))));}","map":null,"metadata":{},"sourceType":"module"}