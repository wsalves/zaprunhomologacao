{"ast":null,"code":"import React,{useEffect,useReducer,useState,useContext}from\"react\";import{Button,IconButton,makeStyles,Paper,Table,TableBody,TableCell,TableHead,TableRow,Typography}from\"@material-ui/core\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import MainHeaderButtonsWrapper from\"../../components/MainHeaderButtonsWrapper\";import TableRowSkeleton from\"../../components/TableRowSkeleton\";import Title from\"../../components/Title\";import{i18n}from\"../../translate/i18n\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import{DeleteOutline,Edit}from\"@material-ui/icons\";import QueueModal from\"../../components/QueueModal\";import{toast}from\"react-toastify\";import ConfirmationModal from\"../../components/ConfirmationModal\";// import { SocketContext } from \"../../context/Socket/SocketContext\";\nimport{AuthContext}from\"../../context/Auth/AuthContext\";import ForbiddenPage from\"../../components/ForbiddenPage\";const useStyles=makeStyles(theme=>({mainPaper:{flex:1,padding:theme.spacing(1),overflowY:\"scroll\",...theme.scrollbarStyles},customTableCell:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\"}}));const reducer=(state,action)=>{if(action.type===\"LOAD_QUEUES\"){const queues=action.payload;const newQueues=[];queues.forEach(queue=>{const queueIndex=state.findIndex(q=>q.id===queue.id);if(queueIndex!==-1){state[queueIndex]=queue;}else{newQueues.push(queue);}});return[...state,...newQueues];}if(action.type===\"UPDATE_QUEUES\"){const queue=action.payload;const queueIndex=state.findIndex(u=>u.id===queue.id);if(queueIndex!==-1){state[queueIndex]=queue;return[...state];}else{return[queue,...state];}}if(action.type===\"DELETE_QUEUE\"){const queueId=action.payload;const queueIndex=state.findIndex(q=>q.id===queueId);if(queueIndex!==-1){state.splice(queueIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}};const Queues=()=>{const classes=useStyles();const[queues,dispatch]=useReducer(reducer,[]);const[loading,setLoading]=useState(false);const[queueModalOpen,setQueueModalOpen]=useState(false);const[selectedQueue,setSelectedQueue]=useState(null);const[confirmModalOpen,setConfirmModalOpen]=useState(false);//   const socketManager = useContext(SocketContext);\nconst{user,socket}=useContext(AuthContext);const companyId=user.companyId;useEffect(()=>{(async()=>{setLoading(true);try{const{data}=await api.get(\"/queue\");dispatch({type:\"LOAD_QUEUES\",payload:data});setLoading(false);}catch(err){toastError(err);setLoading(false);}})();},[]);useEffect(()=>{const onQueueEvent=data=>{if(data.action===\"update\"||data.action===\"create\"){dispatch({type:\"UPDATE_QUEUES\",payload:data.queue});}if(data.action===\"delete\"){dispatch({type:\"DELETE_QUEUE\",payload:data.queueId});}};socket.on(\"company-\".concat(companyId,\"-queue\"),onQueueEvent);return()=>{socket.off(\"company-\".concat(companyId,\"-queue\"),onQueueEvent);};},[socket,companyId]);const handleOpenQueueModal=()=>{setQueueModalOpen(true);setSelectedQueue(null);};const handleCloseQueueModal=()=>{setQueueModalOpen(false);setSelectedQueue(null);};const handleEditQueue=queue=>{setSelectedQueue(queue);setQueueModalOpen(true);};const handleCloseConfirmationModal=()=>{setConfirmModalOpen(false);setSelectedQueue(null);};const handleDeleteQueue=async queueId=>{try{await api.delete(\"/queue/\".concat(queueId));toast.success(i18n.t(\"Queue deleted successfully!\"));}catch(err){toastError(err);}setSelectedQueue(null);};return/*#__PURE__*/React.createElement(MainContainer,null,/*#__PURE__*/React.createElement(ConfirmationModal,{title:selectedQueue&&\"\".concat(i18n.t(\"queues.confirmationModal.deleteTitle\"),\" \").concat(selectedQueue.name,\"?\"),open:confirmModalOpen,onClose:handleCloseConfirmationModal,onConfirm:()=>handleDeleteQueue(selectedQueue.id)},i18n.t(\"queues.confirmationModal.deleteMessage\")),/*#__PURE__*/React.createElement(QueueModal,{open:queueModalOpen,onClose:handleCloseQueueModal,queueId:selectedQueue===null||selectedQueue===void 0?void 0:selectedQueue.id,onEdit:res=>{if(res){setTimeout(()=>{handleEditQueue(res);},500);}}}),user.profile===\"user\"?/*#__PURE__*/React.createElement(ForbiddenPage,null):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(MainHeader,null,/*#__PURE__*/React.createElement(Title,null,i18n.t(\"queues.title\"),\" (\",queues.length,\")\"),/*#__PURE__*/React.createElement(MainHeaderButtonsWrapper,null,/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"primary\",onClick:handleOpenQueueModal},i18n.t(\"queues.buttons.add\")))),/*#__PURE__*/React.createElement(Paper,{className:classes.mainPaper,variant:\"outlined\"},/*#__PURE__*/React.createElement(Table,{size:\"small\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},i18n.t(\"queues.table.ID\")),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},i18n.t(\"queues.table.name\")),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},i18n.t(\"queues.table.color\")),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},i18n.t(\"queues.table.orderQueue\")),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},i18n.t(\"queues.table.greeting\")),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},i18n.t(\"queues.table.actions\")))),/*#__PURE__*/React.createElement(TableBody,null,/*#__PURE__*/React.createElement(React.Fragment,null,queues.map(queue=>/*#__PURE__*/React.createElement(TableRow,{key:queue.id},/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},queue.id),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},queue.name),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},/*#__PURE__*/React.createElement(\"div\",{className:classes.customTableCell},/*#__PURE__*/React.createElement(\"span\",{style:{backgroundColor:queue.color,width:60,height:20,alignSelf:\"center\"}}))),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},/*#__PURE__*/React.createElement(\"div\",{className:classes.customTableCell},/*#__PURE__*/React.createElement(Typography,{style:{width:300,align:\"center\"},noWrap:true,variant:\"body2\"},queue.orderQueue))),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},/*#__PURE__*/React.createElement(\"div\",{className:classes.customTableCell},/*#__PURE__*/React.createElement(Typography,{style:{width:300,align:\"center\"},noWrap:true,variant:\"body2\"},queue.greetingMessage))),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},/*#__PURE__*/React.createElement(IconButton,{size:\"small\",onClick:()=>handleEditQueue(queue)},/*#__PURE__*/React.createElement(Edit,null)),/*#__PURE__*/React.createElement(IconButton,{size:\"small\",onClick:()=>{setSelectedQueue(queue);setConfirmModalOpen(true);}},/*#__PURE__*/React.createElement(DeleteOutline,null))))),loading&&/*#__PURE__*/React.createElement(TableRowSkeleton,{columns:4})))))));};export default Queues;","map":null,"metadata":{},"sourceType":"module"}