{"ast":null,"code":"import React,{useState,useEffect,useReducer,useContext}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import Button from\"@material-ui/core/Button\";import Table from\"@material-ui/core/Table\";import TableBody from\"@material-ui/core/TableBody\";import TableCell from\"@material-ui/core/TableCell\";import TableHead from\"@material-ui/core/TableHead\";import TableRow from\"@material-ui/core/TableRow\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import SubscriptionModal from\"../../components/SubscriptionModal\";import api from\"../../services/api\";import TableRowSkeleton from\"../../components/TableRowSkeleton\";import toastError from\"../../errors/toastError\";import{AuthContext}from\"../../context/Auth/AuthContext\";import moment from\"moment\";import ForbiddenPage from\"../../components/ForbiddenPage\";// Novo componente \"Invoice\"\nconst Invoice=_ref=>{let{invoice,onPayClick}=_ref;const handlePayClick=()=>{// Aqui vocÃª pode abrir o link da fatura com base no \"invoice.detail\"\n// Certifique-se de que \"invoice.detail\" contenha o URL correto da fatura.\n// Exemplo:\nwindow.open(invoice.linkInvoice,\"_blank\");};return/*#__PURE__*/React.createElement(TableRow,{key:invoice.id},/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},invoice.detail),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},invoice.users),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},invoice.connections),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},moment(invoice.dueDate).format(\"DD/MM/YYYY\")),\" \",/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},invoice.value?invoice.value.toLocaleString(\"pt-br\",{style:\"currency\",currency:\"BRL\"}):'N/A'),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},invoice.status!==\"Pago\"?/*#__PURE__*/React.createElement(Button,{size:\"small\",variant:\"outlined\",color:\"secondary\",onClick:handlePayClick},\"PAGAR\"):/*#__PURE__*/React.createElement(Button,{size:\"small\",variant:\"outlined\"},\"PAGO\")));};const reducer=(state,action)=>{if(action.type===\"LOAD_INVOICES\"){const invoices=action.payload;const newUsers=[];invoices.forEach(user=>{const userIndex=state.findIndex(u=>u.id===user.id);if(userIndex!==-1){state[userIndex]=user;}else{newUsers.push(user);}});return[...state,...newUsers];}if(action.type===\"UPDATE_USERS\"){const user=action.payload;const userIndex=state.findIndex(u=>u.id===user.id);if(userIndex!==-1){state[userIndex]=user;return[...state];}else{return[user,...state];}}if(action.type===\"DELETE_USER\"){const userId=action.payload;const userIndex=state.findIndex(u=>u.id===userId);if(userIndex!==-1){state.splice(userIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}};const useStyles=makeStyles(theme=>({mainPaper:{flex:1,padding:theme.spacing(1),overflowY:\"scroll\",...theme.scrollbarStyles}}));const Invoices=()=>{const classes=useStyles();const[loading,setLoading]=useState(false);const[pageNumber,setPageNumber]=useState(1);const[hasMore,setHasMore]=useState(false);const[searchParam,setSearchParam]=useState(\"\");const[invoices,dispatch]=useReducer(reducer,[]);const[storagePlans,setStoragePlans]=React.useState([]);const[selectedContactId,setSelectedContactId]=useState(null);const[contactModalOpen,setContactModalOpen]=useState(false);const{user}=useContext(AuthContext);const handleOpenContactModal=invoices=>{setStoragePlans(invoices);setSelectedContactId(null);setContactModalOpen(true);};const handleCloseContactModal=()=>{setSelectedContactId(null);setContactModalOpen(false);};useEffect(()=>{dispatch({type:\"RESET\"});setPageNumber(1);},[searchParam]);useEffect(()=>{setLoading(true);const delayDebounceFn=setTimeout(()=>{const fetchInvoices=async()=>{try{const{data}=await api.get(\"/invoices\",{params:{searchParam,pageNumber}});dispatch({type:\"LOAD_INVOICES\",payload:data.invoices});setHasMore(data.hasMore);setLoading(false);}catch(err){toastError(err);}};fetchInvoices();},500);return()=>clearTimeout(delayDebounceFn);},[searchParam,pageNumber]);const loadMore=()=>{setPageNumber(prevState=>prevState+1);};const handleScroll=e=>{if(!hasMore||loading)return;const{scrollTop,scrollHeight,clientHeight}=e.currentTarget;if(scrollHeight-(scrollTop+100)<clientHeight){loadMore();}};return/*#__PURE__*/React.createElement(MainContainer,null,/*#__PURE__*/React.createElement(SubscriptionModal,{open:contactModalOpen,onClose:handleCloseContactModal,\"aria-labelledby\":\"form-dialog-title\",Invoice:storagePlans,contactId:selectedContactId}),user.profile===\"user\"?/*#__PURE__*/React.createElement(ForbiddenPage,null):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(MainHeader,null,/*#__PURE__*/React.createElement(Title,null,\"Faturas (\",invoices.length,\")\")),/*#__PURE__*/React.createElement(Paper,{className:classes.mainPaper,variant:\"outlined\",onScroll:handleScroll},/*#__PURE__*/React.createElement(Table,{size:\"small\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Detalhes\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Usu\\xE1rios\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Conex\\xF5es\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Vencimento\"),\" \",/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Valor\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"A\\xE7\\xE3o\"))),/*#__PURE__*/React.createElement(TableBody,null,/*#__PURE__*/React.createElement(React.Fragment,null,invoices.map(invoice=>/*#__PURE__*/React.createElement(Invoice,{key:invoice.id,invoice:invoice})),loading&&/*#__PURE__*/React.createElement(TableRowSkeleton,{columns:6})))))));};export default Invoices;","map":null,"metadata":{},"sourceType":"module"}